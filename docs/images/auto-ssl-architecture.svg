<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700">
  <!-- Title -->
  <text x="500" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">Auto-SSL Architecture (Step CA + nginx-proxy + acme-companion)</text>
  
  <!-- Docker Host Box -->
  <rect x="50" y="60" width="900" height="610" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="10"/>
  <text x="60" y="85" font-size="16" font-weight="bold" fill="#333">Docker Host (Staging/Production Server)</text>
  
  <!-- Step CA Container -->
  <rect x="80" y="110" width="250" height="100" fill="#9C27B0" stroke="#333" stroke-width="2" rx="5"/>
  <text x="205" y="135" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Step CA Container</text>
  <rect x="100" y="150" width="210" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="205" y="170" font-size="11" text-anchor="middle" fill="#333">Private ACME Server</text>
  <text x="205" y="185" font-size="9" text-anchor="middle" fill="#666">smallstep/step-ca</text>
  <text x="205" y="197" font-size="9" text-anchor="middle" fill="#666">Issues SSL Certificates</text>
  
  <!-- nginx-proxy Container -->
  <rect x="360" y="110" width="560" height="100" fill="#009688" stroke="#333" stroke-width="2" rx="5"/>
  <text x="640" y="135" font-size="14" font-weight="bold" text-anchor="middle" fill="white">nginx-proxy Container</text>
  
  <rect x="380" y="150" width="160" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="460" y="170" font-size="11" text-anchor="middle" fill="#333">Nginx 1.27</text>
  <text x="460" y="185" font-size="9" text-anchor="middle" fill="#666">Reverse Proxy</text>
  <text x="460" y="197" font-size="9" text-anchor="middle" fill="#666">Auto-configured</text>
  
  <rect x="560" y="150" width="160" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="640" y="170" font-size="11" text-anchor="middle" fill="#333">docker-gen</text>
  <text x="640" y="185" font-size="9" text-anchor="middle" fill="#666">Watches containers</text>
  <text x="640" y="197" font-size="9" text-anchor="middle" fill="#666">Generates configs</text>
  
  <rect x="740" y="150" width="160" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="820" y="170" font-size="11" text-anchor="middle" fill="#333">Ports 80/443</text>
  <text x="820" y="185" font-size="9" text-anchor="middle" fill="#666">HTTP/HTTPS</text>
  <text x="820" y="197" font-size="9" text-anchor="middle" fill="#666">Entry Point</text>
  
  <!-- acme-companion Container -->
  <rect x="80" y="240" width="840" height="100" fill="#FF9800" stroke="#333" stroke-width="2" rx="5"/>
  <text x="500" y="265" font-size="14" font-weight="bold" text-anchor="middle" fill="white">acme-companion Container</text>
  
  <rect x="100" y="280" width="250" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="225" y="300" font-size="11" text-anchor="middle" fill="#333">Certificate Manager</text>
  <text x="225" y="315" font-size="9" text-anchor="middle" fill="#666">nginxproxy/acme-companion:2.6</text>
  
  <rect x="370" y="280" width="250" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="495" y="295" font-size="10" text-anchor="middle" fill="#333">âœ“ Auto-issue certificates</text>
  <text x="495" y="308" font-size="10" text-anchor="middle" fill="#333">âœ“ Auto-renewal (every 60 days)</text>
  <text x="495" y="321" font-size="10" text-anchor="middle" fill="#333">âœ“ Monitors VIRTUAL_HOST</text>
  
  <rect x="640" y="280" width="260" height="50" fill="#E3F2FD" stroke="#2196F3" stroke-width="1" rx="3"/>
  <text x="770" y="298" font-size="9" text-anchor="middle" fill="#333">Volumes shared with nginx-proxy:</text>
  <text x="770" y="310" font-size="9" text-anchor="middle" fill="#333">â€¢ certs (SSL certificates)</text>
  <text x="770" y="322" font-size="9" text-anchor="middle" fill="#333">â€¢ vhost.d, html, dhparam</text>
  
  <!-- Web Container -->
  <rect x="80" y="370" width="420" height="150" fill="#4A90E2" stroke="#333" stroke-width="2" rx="5"/>
  <text x="290" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Web Container (Django App)</text>
  
  <rect x="100" y="410" width="380" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="290" y="430" font-size="12" text-anchor="middle" fill="#333">Gunicorn + Django 5.0</text>
  <text x="290" y="445" font-size="10" text-anchor="middle" fill="#666">Internal Port 8000 (not exposed)</text>
  
  <rect x="100" y="470" width="380" height="40" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1" rx="3"/>
  <text x="290" y="485" font-size="10" font-weight="bold" text-anchor="middle" fill="#333">Environment Variables:</text>
  <text x="290" y="498" font-size="9" text-anchor="middle" fill="#333">VIRTUAL_HOST, VIRTUAL_PORT, LETSENCRYPT_HOST, LETSENCRYPT_EMAIL</text>
  
  <!-- DB Container -->
  <rect x="530" y="370" width="390" height="150" fill="#50C878" stroke="#333" stroke-width="2" rx="5"/>
  <text x="725" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="white">DB Container</text>
  
  <rect x="550" y="410" width="350" height="50" fill="white" stroke="#333" stroke-width="1" rx="3"/>
  <text x="725" y="430" font-size="12" text-anchor="middle" fill="#333">PostgreSQL 18.1</text>
  <text x="725" y="445" font-size="10" text-anchor="middle" fill="#666">postgres:18.1-trixie</text>
  
  <rect x="550" y="470" width="350" height="40" fill="#FFE6CC" stroke="#FF9933" stroke-width="1" rx="3"/>
  <text x="725" y="493" font-size="10" text-anchor="middle" fill="#333">Volume: postgres_data (persistent)</text>
  
  <!-- ACME Flow Arrows -->
  <!-- Step CA to acme-companion -->
  <line x1="205" y1="210" x2="225" y2="240" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-purple)"/>
  <text x="150" y="230" font-size="9" fill="#9C27B0">ACME Protocol</text>
  
  <!-- acme-companion to nginx-proxy -->
  <line x1="500" y1="240" x2="640" y2="210" stroke="#FF9800" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead-orange)"/>
  <text x="550" y="230" font-size="9" fill="#FF9800">SSL Certificates</text>
  
  <!-- nginx-proxy to Web -->
  <line x1="640" y1="210" x2="290" y2="370" stroke="#009688" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="480" y="290" font-size="10" fill="#009688">Proxy to :8000</text>
  
  <!-- Web to DB -->
  <line x1="500" y1="445" x2="530" y2="445" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="515" y="435" font-size="9" text-anchor="middle" fill="#333">:5432</text>
  
  <!-- External Access -->
  <rect x="80" y="550" width="840" height="100" fill="#FFF5E6" stroke="#FFA500" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
  <text x="90" y="575" font-size="14" font-weight="bold" fill="#333">External Access</text>
  
  <!-- Browser -->
  <ellipse cx="200" cy="605" rx="100" ry="30" fill="#FF6B6B" stroke="#333" stroke-width="2"/>
  <text x="200" y="605" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Browser/Client</text>
  <text x="200" y="620" font-size="10" text-anchor="middle" fill="white">https://yourdomain.com</text>
  
  <!-- HTTPS Arrow -->
  <line x1="300" y1="600" x2="640" y2="210" stroke="#2E7D32" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <text x="470" y="400" font-size="12" font-weight="bold" fill="#2E7D32">HTTPS (443)</text>
  <text x="470" y="415" font-size="10" fill="#2E7D32">SSL Encrypted</text>
  
  <!-- Key Features Box -->
  <rect x="500" y="560" width="400" height="80" fill="white" stroke="#333" stroke-width="2" rx="5"/>
  <text x="700" y="580" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">ðŸ”’ Auto-SSL Features</text>
  <text x="510" y="600" font-size="10" fill="#333">âœ“ Zero manual configuration</text>
  <text x="510" y="615" font-size="10" fill="#333">âœ“ Automatic certificate issuance</text>
  <text x="510" y="630" font-size="10" fill="#333">âœ“ Automatic renewal (60 days)</text>
  <text x="700" y="600" font-size="10" fill="#333">âœ“ No public domain needed (Step CA)</text>
  <text x="700" y="615" font-size="10" fill="#333">âœ“ Works with Let's Encrypt too</text>
  <text x="700" y="630" font-size="10" fill="#333">âœ“ Multi-app routing support</text>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#9C27B0"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF9800"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2E7D32"/>
    </marker>
  </defs>
</svg>
